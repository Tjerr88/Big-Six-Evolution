<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Big Six Evolution</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #111827; color: #f9fafb; font-size: 1.1rem; }
    .regular-session { background-color: #1f2937; border: 2px solid #4b5563; }
    .test-session { background-color: #374151; border: 3px solid #f59e0b; }
    .score-3 { color: #22c55e; }
    .score-2 { color: #3b82f6; }
    .score-1 { color: #f59e0b; }
    .score-0 { color: #9ca3af; }
    .passed { color: #22c55e; font-weight: bold; }
    .failed { color: #ef4444; font-weight: bold; }
    .selected { background-color: #3b82f6 !important; }
    .scroll-box { max-height: 70vh; overflow-y: auto; white-space: pre-line; }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-2">
  <div id="root" class="w-full max-w-md"></div>

  <script type="text/babel">
    const patterns = {
      "Swing Pattern": ["One-Legged Deadlift", "Double Sumo Deadlift", "Single Leg Glute Bridge", "One-arm Swing", "(Side Stepping) Two-arm Swing", "Double Swing"],
      "Get Up Pattern": ["(3 Min) Get Up", "Supine to Sit Up", "Windmill", "Bent Press", "Supine to Half Kneel", "Half Kneel to Stand"],
      "Clean Pattern": ["HS-Plank", "Front Rack Carry", "Single Dead Clean", "Double Clean", "Pull Up/Chin Up", "One-arm Row"],
      "Squat Pattern": ["B-stance Goblet Squat", "Single Front Squat", "Paused Front Squat", "Double Front Squat", "Athletic Lunge", "Bottom Up Squat"],
      "Press Pattern": ["Military Press", "Top Down Press", "Half Kneeling Press", "Floor Press", "Double Push Press", "Double Push Jerk"],
      "Snatch Pattern": ["Overhead Carry", "Snatch", "Low Pull Snatch", "High Pull", "Front/Side Raise Snatch", "Double Snatch"],
      "Hybrid Pattern": ["Double Clean & Press", "Double Clean & Front Squat", "Double Snatch & Overhead Walk", "Double Clean & Jerk", "Double Snatch & Press", "Double Front Squat & Push Press"]
    };

    const cycleVolumes = {
      1: { low: 10, medium: 20, high: 30 },
      2: { low: 15, medium: 25, high: 40 },
      3: { low: 20, medium: 30, high: 50 }
    };

    const swingLadderExercises = ["One-arm Swing", "(Side Stepping) Two-arm Swing", "Snatch", "High Pull"];
    const evenLadderExercises = ["Double Push Press", "Double Push Jerk", "Double Clean", "Double Swing", "Double Snatch", "Double Front Squat"];
    const timeBasedExercises = ["Overhead Carry", "Front Rack Carry", "HS-Plank"];
    const hybridExercises = ["Double Clean & Press", "Double Clean & Front Squat", "Double Snatch & Overhead Walk", "Double Clean & Jerk", "Double Snatch & Press", "Double Front Squat & Push Press"];

    const randomChoice = arr => arr[Math.floor(Math.random() * arr.length)];

    function calculateVolume(exercise, volumeType, cycle) {
      const base = cycleVolumes[cycle][volumeType];
      if (exercise === "(3 Min) Get Up") {
        if (volumeType === "low") return cycle;
        if (volumeType === "medium") return cycle + 1;
        if (volumeType === "high") return cycle + 2;
      }
      if (hybridExercises.includes(exercise)) return cycleVolumes[cycle]["low"];
      if (timeBasedExercises.includes(exercise)) {
        const timeMap = {
          1: { low: 30, medium: 60, high: 90 },
          2: { low: 45, medium: 75, high: 105 },
          3: { low: 60, medium: 90, high: 120 }
        };
        return timeMap[cycle][volumeType];
      }
      return base;
    }

    function getLadderPattern(exercise, volume, cycle) {
      if (timeBasedExercises.includes(exercise)) return [`${volume} sec`, volume];
      if (hybridExercises.includes(exercise)) {
        if (cycle === 1) return ["1-2-3-4", 10];
        if (cycle === 2) return ["1-2-3-4-5", 15];
        if (cycle === 3) return ["2x 1-2-3-4", 20];
      }
      if (swingLadderExercises.includes(exercise)) {
        const map = {
          1: {10:"10",20:"5-15",30:"5-10-15"},
          2: {15:"5-10",25:"10-15",40:"5-15-20"},
          3: {20:"5-15",30:"10-20",50:"10-15-25"}
        };
        return [map[cycle][volume] || `${volume}`, volume];
      }
      if (evenLadderExercises.includes(exercise)) {
        const map = {
          1: {10:"4-6",20:"2-4-6-8",30:"2-4-6-8-10"},
          2: {15:"2-4-6 + 1-2",25:"2x 2-4-6 + 1",40:"2-4-6-8-10 + 2-4-6"},
          3: {20:"2-4-6-8",30:"2-4-6-8-10",50:"2x 2-4-6-8 + 2-4"}
        };
        return [map[cycle][volume] || `${volume}`, volume];
      }
      const map = {
        1: {10:"1-2-3-4",20:"2x 1-2-3-4",30:"3x 1-2-3-4"},
        2: {15:"1-2-3-4-5",25:"1-2-3-4-5 + 1-2-3-4",40:"2x 1-2-3-4-5 + 1-2-3-4"},
        3: {20:"2x 1-2-3-4",30:"2x 1-2-3-4-5",50:"3x 1-2-3-4-5 + 1-2"}
      };
      return [map[cycle][volume] || `${volume} reps`, volume];
    }

    function getVolumeFormat(exercise, volume, cycle) {
      const [pattern, total] = getLadderPattern(exercise, volume, cycle);
      if (timeBasedExercises.includes(exercise)) return pattern;
      return `${total} reps (${pattern})`;
    }

    function generatePhase(cycle, phase) {
      let sessions = [];
      let lastExercises = [];
      let lastVolumes = {};

      for (let i = 1; i <= 36; i++) {
        const patternsList = Object.keys(patterns).sort(() => Math.random() - 0.5);
        let currentVolTypes = {};
        for (let pattern of patternsList) {
          let choices = patterns[pattern].filter(ex => !lastExercises.includes(ex));
          if (choices.length === 0) choices = patterns[pattern];
          const exercise = randomChoice(choices);
          let types = ["low", "medium", "high"];
          if (hybridExercises.includes(exercise)) types = ["low"];
          const volumeType = randomChoice(types);
          const vol = calculateVolume(exercise, volumeType, phase);
          sessions.push({
            session: i,
            cycle,
            phase,
            pattern,
            exercise,
            volumeType,
            volume: vol,
            formattedVolume: getVolumeFormat(exercise, vol, phase),
            order: patternsList.indexOf(pattern) + 1
          });
          currentVolTypes[pattern] = volumeType;
        }
        lastExercises = sessions.slice(-7).map(s => s.exercise);
        lastVolumes = currentVolTypes;
      }

      const testSession = [
        { exercise: "One-arm Swing", formattedVolume: "10 reps each arm" },
        { exercise: "Get Up", formattedVolume: "1 rep each arm" },
        { exercise: "Double Clean", formattedVolume: "5 reps" },
        { exercise: "Military Press", formattedVolume: "5 reps each arm" },
        { exercise: "Double Front Squat", formattedVolume: "5 reps" },
        { exercise: "Snatch", formattedVolume: "5 reps each arm" }
      ].map((ex, idx) => ({
        session: 37,
        cycle,
        phase,
        pattern: "Test Session",
        ...ex,
        volumeType: "test",
        volume: null,
        order: idx + 1
      }));
      sessions.push(...testSession);

      return sessions;
    }

    const OS_RESET = `20 cross crawl
2 minutes diaphragmatic breathing
20 neck nods (hold 5th/15th chin tucked, 10th/20th chin up)
Segmental rolls, 3 per limb
20 Rocking (10 plantar, 10 dorsiflexion)
2 minutes Baby crawl

Keep tongue on the roof of your mouth during all resets`;

    const GFM_MOBILITY = `Ground Force Method General Mobility

Hips
Figure 4 position, figure 4 lunge, half heel sit,
Z position switches and side rolls,
Hip Openers – Prone to TGU to Bridge

Shoulders
The Egyptian – Seated, Pike, Prone
S movement – Seated, Pike, Prone
Figure 8 in Crawl – 6 point & 4 point
Crawl to crab
Pike to tabletop

Ankles
Ankle series – Up & down, in & out, Rotations
Figure 8’s toes and ankle
Snail
Crawl-frog-crab transitions

Spine & Neck
Supine neck rolls – Left to right
Hand on knee rolling
Segmental rolling – Neck, arms & legs
Forward and backward rolling

Wrists
Finger waves
Hand circles
Tea pot`;

    const KB_MOBILITY = `Kettlebell Mobility

Arm Bar
2/3 Bent Arm Bar
3/5 Rib Pull
3/5 Bretzel
3/5 Windmill
3/3 Bent Press
5/10 Pump Stretch
5/10 Tactical Frog
10 Overhead Hip Flexor Stretch
5 Prying Goblet Squat
3/5 Cossack Squat
5/10 Goodmorning Hamstring Stretch
5/10 Kettlebell Pull over
3/5 Get Up High Bridge
5 Tall kneeling Halo
3 Tall Kneeling Rotations`;

    const FULL_REST_ADVICE = `Full rest day advice:

- Aim for 8 hours of sleep
- Stay hydrated (2 liters water minimum)
- Focus on protein and micronutrients
- Optional: light walk or breathing drills
- Avoid strenuous exercise and prioritize recovery`;

    function App() {
      const [program, setProgram] = React.useState(() =>
        JSON.parse(localStorage.getItem("b6e_program")) || null
      );
      const [cycle, setCycle] = React.useState(() =>
        JSON.parse(localStorage.getItem("b6e_cycle")) || 1
      );
      const [phase, setPhase] = React.useState(() =>
        JSON.parse(localStorage.getItem("b6e_phase")) || 1
      );
      const [index, setIndex] = React.useState(() =>
        JSON.parse(localStorage.getItem("b6e_index")) || 0
      );
      const [history, setHistory] = React.useState(() =>
        JSON.parse(localStorage.getItem("b6e_history")) || []
      );
      const [mode, setMode] = React.useState("checkQuestions");
      const [answers, setAnswers] = React.useState({ sleep: null, soreness: null, energy: null });
      const [selectedAnswers, setSelectedAnswers] = React.useState({});
      const [recoveryFlow, setRecoveryFlow] = React.useState("");
      const [timer, setTimer] = React.useState(0);
      const [running, setRunning] = React.useState(false);
      const [testChecks, setTestChecks] = React.useState({});
      const [previousTest, setPreviousTest] = React.useState(() =>
        JSON.parse(localStorage.getItem("b6e_lastTest")) || null
      );

      React.useEffect(() => {
        let interval = null;
        if (running) interval = setInterval(() => setTimer((t) => t + 1), 1000);
        return () => clearInterval(interval);
      }, [running]);

      const startProgram = () => {
        const prog = generatePhase(cycle, phase);
        setProgram(prog);
        setIndex(0);
        localStorage.setItem("b6e_program", JSON.stringify(prog));
        localStorage.setItem("b6e_cycle", cycle);
        localStorage.setItem("b6e_phase", phase);
        localStorage.setItem("b6e_index", 0);
      };

      const handleAnswer = (question, value) => {
        setAnswers({ ...answers, [question]: value });
        setSelectedAnswers({ ...selectedAnswers, [question]: value });
      };

      const calculateScore = () => {
        let score = 0;
        if (answers.sleep === "good") score++;
        if (answers.soreness === "good") score++;
        if (answers.energy === "good") score++;
        return score;
      };

      const finalizeCheck = () => {
        const score = calculateScore();
        if (score === 3 || score === 2) setMode("training");
        else if (score === 1) setMode("recoveryChoice");
        else setMode("rest");
      };

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, "0")}`;
      };

      const logSession = (entryType) => {
        const now = new Date();
        const score = calculateScore();
        const entry = {
          date: now.toLocaleString(),
          type: `${entryType} (${score}/3) – ${formatTime(timer)}`
        };
        const updatedHistory = [...history, entry];
        setHistory(updatedHistory);
        localStorage.setItem("b6e_history", JSON.stringify(updatedHistory));
        setTimer(0);
      };

      const markComplete = () => {
        const currentSession = program.slice(index, index + 7);
        logSession(`Cycle ${cycle} – Phase ${phase} – Session ${currentSession[0].session}`);
        const next = index + 7;
        setIndex(next);
        localStorage.setItem("b6e_index", next);
        setMode("checkQuestions");
      };

      const previousSession = () => {
        if (index >= 7) {
          setIndex(index - 7);
          localStorage.setItem("b6e_index", index - 7);
        }
      };

      const logRecovery = (type) => {
        logSession(`Recovery: ${type}`);
        setMode("checkQuestions");
      };

      const logRestDay = () => {
        logSession("Full Rest Day");
        setMode("checkQuestions");
      };

      const toggleCheck = (exercise) => {
        setTestChecks(prev => ({ ...prev, [exercise]: !prev[exercise] }));
      };

      const submitTestResult = () => {
        const allPassed = Object.values(testChecks).every(Boolean);
        const passedCount = Object.values(testChecks).filter(Boolean).length;
        const now = new Date();
        const detail = {
          date: now.toLocaleString(),
          cycle,
          phase,
          results: testChecks,
          passedCount
        };
        setPreviousTest(detail);
        localStorage.setItem("b6e_lastTest", JSON.stringify(detail));
        const summary = `Test – Cycle ${cycle} Phase ${phase} – ${passedCount}/6 passed`;
        const updatedHistory = [...history, { date: now.toLocaleString(), type: summary }];
        setHistory(updatedHistory);
        localStorage.setItem("b6e_history", JSON.stringify(updatedHistory));

        if (allPassed) {
          alert("Perfect! Start a new cycle with a heavier kettlebell.");
          setCycle(cycle + 1);
          setPhase(1);
          const prog = generatePhase(cycle + 1, 1);
          setProgram(prog);
          setIndex(0);
          localStorage.setItem("b6e_cycle", cycle + 1);
          localStorage.setItem("b6e_phase", 1);
          localStorage.setItem("b6e_program", JSON.stringify(prog));
          localStorage.setItem("b6e_index", 0);
        } else {
          if (phase < 3) {
            alert("Continue with the next phase of the current cycle with the current kettlebell weight.");
            setPhase(phase + 1);
            const prog = generatePhase(cycle, phase + 1);
            setProgram(prog);
            setIndex(0);
            localStorage.setItem("b6e_phase", phase + 1);
            localStorage.setItem("b6e_program", JSON.stringify(prog));
            localStorage.setItem("b6e_index", 0);
          } else {
            alert("Not passed – repeat Phase 3 with the current kettlebell weight and retest afterwards.");
            const prog = generatePhase(cycle, 3);
            setProgram(prog);
            setIndex(0);
            localStorage.setItem("b6e_program", JSON.stringify(prog));
            localStorage.setItem("b6e_index", 0);
          }
        }

        setTestChecks({});
        setMode("checkQuestions");
      };

      const clearHistory = () => {
        if (confirm("Are you sure you want to clear the entire history?")) {
          setHistory([]);
          setPreviousTest(null);
          localStorage.removeItem("b6e_history");
          localStorage.removeItem("b6e_lastTest");
        }
      };

      if (!program) {
        return (
          <div className="text-center space-y-6">
            <h1 className="text-3xl font-bold">Big Six Evolution</h1>
            <button onClick={startProgram} className="w-full py-4 bg-green-600 rounded-xl text-xl font-semibold hover:bg-green-700">
              Start Program
            </button>
          </div>
        );
      }

      if (mode === "checkQuestions") {
        const questions = [
          { key: "sleep", label: "How well did you sleep?" },
          { key: "soreness", label: "How sore are you?" },
          { key: "energy", label: "How is your energy today?" }
        ];

        const allAnswered = Object.values(answers).every(a => a !== null);

        return (
          <div className="space-y-6 text-center">
            <h2 className="text-2xl font-bold">Daily Check</h2>
            {questions.map(q => (
              <div key={q.key} className="space-y-2">
                <p className="font-semibold">{q.label}</p>
                <div className="flex space-x-2 justify-center">
                  <button
                    onClick={() => handleAnswer(q.key, "good")}
                    className={`px-4 py-2 rounded ${selectedAnswers[q.key]==="good" ? "selected" : "bg-green-600"}`}
                  >
                    Good
                  </button>
                  <button
                    onClick={() => handleAnswer(q.key, "bad")}
                    className={`px-4 py-2 rounded ${selectedAnswers[q.key]==="bad" ? "selected" : "bg-gray-600"}`}
                  >
                    Poor
                  </button>
                </div>
              </div>
            ))}

            {allAnswered && (
              <button onClick={finalizeCheck} className="w-full py-3 bg-blue-600 rounded-xl text-lg hover:bg-blue-700">
                Continue
              </button>
            )}

            <div className="pt-6">
              <h3 className="text-xl font-bold mb-2">History</h3>
              {history.length === 0 ? (
                <p className="text-gray-400">No sessions yet</p>
              ) : (
                <ul className="space-y-1 max-h-48 overflow-y-auto">
                  {history.slice().reverse().map((h, i) => (
                    <li key={i} className={`bg-gray-700 rounded p-2 text-sm ${
                      h.type.includes("(3/3)") ? "score-3" :
                      h.type.includes("(2/3)") ? "score-2" :
                      h.type.includes("(1/3)") ? "score-1" : "score-0"
                    }`}>{h.date} – {h.type}</li>
                  ))}
                </ul>
              )}
              {history.length > 0 && (
                <button onClick={clearHistory} className="mt-2 w-full py-2 bg-red-600 rounded-xl hover:bg-red-700">
                  Clear History
                </button>
              )}
            </div>
          </div>
        );
      }

      if (mode === "training") {
        const currentSession = program.slice(index, index + 7);
        const isTest = currentSession[0]?.pattern === "Test Session";
        if (isTest) {
          setMode("test");
          return null;
        }

        return (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold text-center">
              Cycle {cycle} – Phase {phase} – Session {currentSession[0].session}
            </h2>
            <div className={`p-4 rounded-xl shadow-md regular-session`}>
              {currentSession.map((ex, i) => (
                <div key={i} className="mb-3">
                  <div className="font-bold text-lg">{ex.pattern}</div>
                  <div className="text-base">{ex.exercise} – {ex.formattedVolume}</div>
                </div>
              ))}
            </div>
            <div className="flex justify-between space-x-2">
              <button onClick={() => setRunning(!running)} className="w-1/3 py-2 bg-purple-600 rounded-xl text-sm font-semibold hover:bg-purple-700">
                {running ? "Stop Timer" : "Start Timer"}
              </button>
              <div className="w-1/3 text-center font-bold text-lg">{formatTime(timer)}</div>
              <button onClick={previousSession} className="w-1/3 py-2 bg-gray-600 rounded-xl text-sm hover:bg-gray-700">
                Previous
              </button>
            </div>
            <button onClick={markComplete} className="w-full py-4 bg-blue-600 rounded-xl text-lg font-semibold hover:bg-blue-700">
              Complete
            </button>
          </div>
        );
      }

      if (mode === "test") {
        const currentSession = program.slice(index, index + 6);

        return (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold text-center">
              Test Day – Cycle {cycle} Phase {phase}
            </h2>

            {previousTest && (
              <div className="bg-gray-700 p-3 rounded text-sm">
                <h3 className="font-bold mb-2">Previous Test Results:</h3>
                {Object.entries(previousTest.results).map(([ex, passed]) => (
                  <p key={ex} className={passed ? "passed" : "failed"}>
                    {ex}: {passed ? "Passed" : "Failed"}
                  </p>
                ))}
                <p className="mt-2">Passed {previousTest.passedCount}/6 exercises</p>
              </div>
            )}

            <div className="p-4 rounded-xl shadow-md test-session">
              {currentSession.map((ex, i) => (
                <div key={i} className="flex justify-between mb-2">
                  <span>{ex.exercise} – {ex.formattedVolume}</span>
                  <input
                    type="checkbox"
                    checked={testChecks[ex.exercise] || false}
                    onChange={() => toggleCheck(ex.exercise)}
                  />
                </div>
              ))}
            </div>

            <div className="flex justify-between space-x-2">
              <button onClick={() => setRunning(!running)} className="w-1/3 py-2 bg-purple-600 rounded-xl text-sm font-semibold hover:bg-purple-700">
                {running ? "Stop Timer" : "Start Timer"}
              </button>
              <div className="w-1/3 text-center font-bold text-lg">{formatTime(timer)}</div>
              <button onClick={previousSession} className="w-1/3 py-2 bg-gray-600 rounded-xl text-sm hover:bg-gray-700">
                Previous
              </button>
            </div>

            <button onClick={submitTestResult} className="w-full py-4 bg-blue-600 rounded-xl text-lg font-semibold hover:bg-blue-700">
              Submit Test Result
            </button>
          </div>
        );
      }

      if (mode === "recoveryChoice") {
        return (
          <div className="space-y-6 text-center">
            <h2 className="text-2xl font-bold">Choose Recovery Session</h2>
            <button onClick={() => {setRecoveryFlow(OS_RESET); setMode("recovery");}} className="w-full py-3 bg-green-600 rounded-xl text-lg hover:bg-green-700">OS Reset</button>
            <button onClick={() => {setRecoveryFlow(GFM_MOBILITY); setMode("recovery");}} className="w-full py-3 bg-blue-600 rounded-xl text-lg hover:bg-blue-700">GFM Mobility</button>
            <button onClick={() => {setRecoveryFlow(KB_MOBILITY); setMode("recovery");}} className="w-full py-3 bg-purple-600 rounded-xl text-lg hover:bg-purple-700">Kettlebell Mobility</button>
          </div>
        );
      }

      if (mode === "recovery") {
        return (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold text-center">Recovery Flow</h2>
            <div className="scroll-box bg-gray-700 rounded-xl p-4 text-left text-sm">
              {recoveryFlow}
            </div>
            <div className="flex justify-between space-x-2">
              <button onClick={() => setRunning(!running)} className="w-1/3 py-2 bg-purple-600 rounded-xl text-sm font-semibold hover:bg-purple-700">
                {running ? "Stop Timer" : "Start Timer"}
              </button>
              <div className="w-1/3 text-center font-bold text-lg">{formatTime(timer)}</div>
              <button onClick={previousSession} className="w-1/3 py-2 bg-gray-600 rounded-xl text-sm hover:bg-gray-700">
                Previous
              </button>
            </div>
            <button onClick={() => logRecovery(
              recoveryFlow.startsWith("20 cross") ? "OS Reset" :
              recoveryFlow.startsWith("Ground Force") ? "GFM Mobility" :
              "Kettlebell Mobility"
            )} className="w-full py-4 bg-blue-600 rounded-xl text-lg font-semibold hover:bg-blue-700">
              Done
            </button>
          </div>
        );
      }

      if (mode === "rest") {
        return (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold text-center">Full Rest Day</h2>
            <div className="scroll-box bg-gray-700 rounded-xl p-4 text-left text-sm">
              {FULL_REST_ADVICE}
            </div>
            <button onClick={logRestDay} className="w-full py-4 bg-blue-600 rounded-xl text-lg font-semibold hover:bg-blue-700">
              Back to Start
            </button>
          </div>
        );
      }
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
